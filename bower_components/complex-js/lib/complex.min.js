/* Copyright (c) 2015 Patrick Roberts */!function(t){"use strict";function r(t){return t>=0?t-t%1:t-(1+t%1)%1}function n(t){return t>=0?t+(1-t%1)%1:t-t%1}function e(t){return r(t+.5)}function i(t){return t-t%1}function o(t){return t%1}function a(t,r,n,e){return this instanceof a?(this.m="number"==typeof n?w.abs(n):w.sqrt(t*t+r*r),this.t="number"==typeof e?n>=0?e:e+b:w.atan2(r,t),this.t=(this.t%(2*b)+2*b)%(2*b),this.t-=this.t>b?2*b:0,this.r=t,void(this.i=r)):new a(t,r,n,e)}function c(t,r,n){var e;return q.test(t)?S.test(n.slice(r))?t:t.charAt(0).replace(x,c)+"*"+t.charAt(1).replace(x,c):O.test(t)?"(":I.test(t)?")":(e=t.search(T),t.charAt(-1!==e?e:"*"))}function s(t){var r,n,e,i=/[^a-z]+/gi,o="abcdefghijklmnopqrstuvwxyz",a=o.length,c={},s="";for(t=t.map(function(t){var r=t.replace(i,"");if(t!==r)throw new SyntaxError('"'+t+'" is an invalid variable name.');return r.toLowerCase()}),r=0;r<t.length;r++){if(c[t[r]])throw new ReferenceError("May not have duplicate parameter names.");for(n=r;n>=0;)e=n%a,n-=e,s=o.charAt(e)+s,n=n/a-1;c[t[r]]=s,s=""}return c}function u(t,r){for(var n=1;n>0&&r<t.length;)"("===t[r]&&n++,")"===t[r]&&n--,r++;if(n>0)throw new SyntaxError('Expected ")".');return r-1}function h(t,r){var n,e,i=0;for(n=r;n<t.length;n++){if("("===t[n]?i++:")"===t[n]&&i--,0>i)throw new SyntaxError('Unexpected token ")".');if(0===i&&("+"===t[n]||"-"===t[n]&&!A[t[n-1]])&&(e=t.substr(w.max(0,n-3)).search(S),-1===e||e>1))return n}return t.length}function p(t,r){var n,e,i=0;for(n=r;n<t.length;n++){if("("===t[n]?i++:")"===t[n]&&i--,0>i)throw new SyntaxError('Unexpected token ")".');if(0===i){if(("+"===t[n]||"-"===t[n]&&!A[t[n-1]])&&(e=t.substr(w.max(0,n-3)).search(S),-1===e||e>1))return n;if("*"===t[n]||"/"===t[n]||" "===t[n]||"%"===t[n])return n}}return t.length}function f(t,r,n){switch(t){case"+":case"-":return h(r,n);case"*":case" ":case"/":case"%":case"^":return p(r,n);default:throw new SyntaxError('"'+t+'" is not a valid operator.')}}function d(){Array.apply(this,arguments)}function l(t,r,n){var e,i,o,c,s,d,m="",C=0,w=!1;if(0===t.length)throw new SyntaxError('"" is not a valid argument.');for(;C<t.length;)if(w||0!==t.substr(C).search(y))if(w||0!==t.substr(C).search(E))if(w||0!==t.substr(C).search(P)){if(!w||0!==t.substr(C).search(N))throw new SyntaxError('Unexpected token "'+t.charAt(C)+'".');if(e=t.substr(C).match(N)[0],c=A[e],d=f(e,t,C+e.length),!c)throw new SyntaxError('"'+e+'" is not a valid operator.');m+=c,C+=e.length,m+=l(t.substring(C,d),r,n)+")",C=")"===t[d]?d+1:d,w=!0}else{if(e=t.substr(C).match(P)[0],s=parseFloat(e),isNaN(s))throw new TypeError('"'+e+'" is not a valid number.');m+="this["+n.push(new a(s,0,s,0))+"]",C+=e.length,w=!0}else{if(e=t.substr(C).match(E)[0],i=z[e]||r[e],!i)throw new ReferenceError('"'+e+'" is not a valid variable.');m+=i,C+=e.length,w=!0}else{switch(e=t.substr(C).match(y)[0],o=W[e],e){case"-":d=h(t,C+e.length);break;case"e^":d=p(t,C+e.length);break;default:d=u(t,C+e.length)}if(o)m+="("===o?"":o,C+=e.length,m+=l(t.substring(C,d),r,n)+("("===o?"":")"),C=")"===t[d]?d+1:d,w=!0;else{if(e=e.substr(0,e.length-1),!z[e]&&!r[e])throw new ReferenceError('"'+e+'(" is not a valid function.');t=t.substr(0,C)+e+"*("+t.substr(C+e.length+1)}}return m}var m,C,w=t.Math,g=t.Number,b=w.PI,v=[],x=/\d[a-z\{\[\(]|[\}\]\)][a-z\d]|(?:[\{\}\[\]]| *[\+\-\*\/\^ %] *)/gi,y=/[a-z]*\(|(?:-|e\^)\(?/i,E=/[a-z]+(?![a-z\(])/i,N=/[\+\-\*\/\^ %]/,P=/(?:\d*\.\d+|\d+\.\d*|\d+)(?:e[\-+]?\d+(?![\d\.]))?/i,O=/\{|\[/,I=/\}|\]/,q=/\d[a-z\{\[\(]|[\}\]\)][a-z\d]/i,S=/(?:\d*\.\d+|\d+\.\d*|\d+)e[\-+]?\d+(?![\d\.])/i,T=/[\+\-\*\/\^%]/,W={"(":"(","sqrt(":"C.sqrt(","cbrt(":"C.cbrt(","exp(":"C.exp(","e^(":"C.exp(","e^":"C.exp(","log(":"C.log(","ln(":"C.log(","gamma(":"C.gamma(","fact(":"C.fact(","factorial(":"C.fact(","sin(":"C.sin(","cos(":"C.cos(","tan(":"C.tan(","sec(":"C.sec(","csc(":"C.csc(","cot(":"C.cot(","arcsin(":"C.arcsin(","arccos(":"C.arccos(","arctan(":"C.arctan(","arcsec(":"C.arcsec(","arccsc(":"C.arccsc(","arccot(":"C.arccot(","arsin(":"C.arcsin(","arcos(":"C.arccos(","artan(":"C.arctan(","arsec(":"C.arcsec(","arcsc(":"C.arccsc(","arcot(":"C.arccot(","asin(":"C.arcsin(","acos(":"C.arccos(","atan(":"C.arctan(","asec(":"C.arcsec(","acsc(":"C.arccsc(","acot(":"C.arccot(","sinh(":"C.sinh(","cosh(":"C.cosh(","tanh(":"C.tanh(","sech(":"C.sech(","csch(":"C.csch(","coth(":"C.coth(","arcsinh(":"C.arcsinh(","arccosh(":"C.arccosh(","arctanh(":"C.arctanh(","arcsech(":"C.arcsech(","arccsch(":"C.arccsch(","arccoth(":"C.arccoth(","arsinh(":"C.arcsinh(","arcosh(":"C.arccosh(","artanh(":"C.arctanh(","arsech(":"C.arcsech(","arcsch(":"C.arccsch(","arcoth(":"C.arccoth(","asinh(":"C.arcsinh(","acosh(":"C.arccosh(","atanh(":"C.arctanh(","asech(":"C.arcsech(","acsch(":"C.arccsch(","acoth(":"C.arccoth(","-":"C.neg(","-(":"C.neg(","re(":"C.re(","real(":"C.re(","im(":"C.im(","imag(":"C.im(","abs(":"C.abs(","mag(":"C.abs(","arg(":"C.arg(","conj(":"C.conj(","norm(":"C.norm(","normal(":"C.norm(","floor(":"C.floor(","ceil(":"C.ceil(","ceiling(":"C.ceil(","round(":"C.round(","fpart(":"C.fPart(","frac(":"C.fPart(","ipart(":"C.iPart(","int(":"C.iPart("},A={"+":".add(","-":".sub(","*":".mult("," ":".mult(","/":".div(","%":".mod(","^":".pow("},z={e:"C.E",i:"C.I",pi:"C.PI"};void 0===w.sinh&&(w.sinh=function(t){return(-w.exp(-t)+w.exp(t))/2}),void 0===w.cosh&&(w.cosh=function(t){return(w.exp(-t)+w.exp(t))/2}),void 0===g.EPSILON&&(g.EPSILON=2.220446049250313e-16),m=new a(w.sqrt(2*b),0,w.sqrt(2*b),0),C=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7].map(function(t,r){return v.push(new a(r,0,r,0)),new a(t,0,w.abs(t),0>t?b:0)}),a.ZERO=new a(0,0,0,0),a.ONE=new a(1,0,1,0),a.I=new a(0,1,1,b/2),a.NEG_I=new a(0,-1,1,3*b/2),a.PI=new a(b,0,b,0),a.E=new a(w.E,0,w.E,0),a.TWO=new a(2,0,2,0),a.TWO_I=new a(0,2,2,b/2),a.Polar=function(t,r){return new a(t*w.cos(r),t*w.sin(r),t,r)},a.prototype.toString=function(t){var r,n,e,i;return a.isFinite(this)||isNaN(this.m)?a.isNaN(this)?"NaN":t?(r=this.r.toPrecision().toUpperCase(),n=this.i.toPrecision().toUpperCase(),0===this.i?r:0===this.r?1===w.abs(this.i)?this.i>0?"i":"-i":n+" i":r+(this.i>0?"+":"")+(1===w.abs(this.i)?this.i>0?"i":"-i":n+" i")):(e=this.m.toPrecision().toUpperCase(),i=this.t.toPrecision().toUpperCase(),0===this.m||0===this.t?e:e+" e^("+i+" i)"):"Infinity"},a.prototype.equals=a.prototype["="]=function(t){var r=this.r,n=this.i,e=this.m,i=this.t,o=t.r,a=t.i,c=t.m,s=t.t,u=w.abs(r-o)<=w.max(w.abs(r),w.abs(o))*g.EPSILON,h=w.abs(n-a)<=w.max(w.abs(n),w.abs(a))*g.EPSILON,p=w.abs(e-c)<=w.max(w.abs(e),w.abs(c))*g.EPSILON,f=w.abs(i-s)<=w.max(w.abs(i),w.abs(s))*g.EPSILON;return u&&h||p&&f},a.prototype.re=a.prototype.real=function(){return this.r},a.prototype.im=a.prototype.imag=function(){return this.i},a.prototype.abs=a.prototype.mag=function(){return this.m},a.prototype.arg=a.prototype.angle=function(){return this.t},a.prototype.rAdd=function(t){return new a(this.r+t,this.i)},a.prototype.add=a.prototype["+"]=function(t){return new a(this.r+t.r,this.i+t.i)},a.prototype.rSub=function(t){return new a(this.r-t,this.i)},a.prototype.sub=a.prototype["-"]=function(t){return new a(this.r-t.r,this.i-t.i)},a.prototype.rMult=function(t){return a.Polar(this.m*t,this.t)},a.prototype.mult=a.prototype["*"]=function(t){return a.Polar(this.m*t.m,this.t+t.t)},a.prototype.rDiv=function(t){return a.Polar(this.m/t,this.t)},a.prototype.div=a.prototype["/"]=function(t){return a.Polar(this.m/t.m,this.t-t.t)},a.prototype.rMod=function(t){return new a(0===t?0:this.r%t,this.i)},a.prototype.mod=a.prototype["%"]=function(t){return new a(0===t.r?0:this.r%t.r,0===t.i?0:this.i%t.i)},a.prototype.rPow=function(t){return 0===t?new a(1,0,1,0):1===t?new a(this.r,this.i,this.m,this.t):2===t?a.square(this):3===t?a.cube(this):a.Polar(w.pow(this.m,t),this.t*t)},a.prototype.pow=a.prototype["^"]=function(t){return 0===t.i?this.rPow(t.r):a.Polar(w.pow(this.m,t.r)*w.exp(-t.i*this.t),t.i*w.log(this.m)+t.r*this.t)},a.neg=function(t){return new a(-t.r,-t.i,t.m,t.t+b)},a.re=function(t){return new a(t.r,0,w.abs(t.r),t.r<0?b:0)},a.im=function(t){return new a(t.i,0,w.abs(t.i),t.i<0?b:0)},a.abs=function(t){return new a(t.m,0,t.m,0)},a.arg=function(t){return new a(t.t,0,w.abs(t.t),t.t<0?b:0)},a.conj=function(t){return new a(t.r,-t.i,t.m,(2*b-t.t)%b*2)},a.norm=function(t){return a.Polar(t.m/t.m,0===t.m?0:t.t)},a.floor=function(t){return new a(r(t.r),r(t.i))},a.ceil=function(t){return new a(n(t.r),n(t.i))},a.round=function(t){return new a(e(t.r),e(t.i))},a.iPart=function(t){return new a(i(t.r),i(t.i))},a.fPart=function(t){return new a(o(t.r),o(t.i))},a.square=function(t){return new a(t.r*t.r-t.i*t.i,2*t.r*t.i,t.m*t.m,2*t.t)},a.cube=function(t){return new a(t.r*t.r*t.r-3*t.r*t.i*t.i,3*t.r*t.r*t.i-t.i*t.i*t.i,t.m*t.m*t.m,3*t.t)},a.sqrt=function(t){return t.rPow(.5)},a.cbrt=function(t){return t.rPow(1/3)},a.exp=function(t){return 0===t.i?a.E.rPow(t.r):a.Polar(w.exp(t.r),t.i)},a.log=function(t){return new a(w.log(t.m),t.t)},a.gamma=function(t){var r,n,e,i;if(t.r<.5)return a.PI.div(a.sin(a.PI.mult(t)).mult(a.gamma(a.ONE.sub(t))));for(r=t.sub(a.ONE),n=C[0],e=1;9>e;e++)n=n.add(C[e].div(r.add(v[e])));return i=r.add(new a(7.5,0,7.5,0)),m.mult(i.pow(r.add(new a(.5,0,.5,0)))).mult(a.exp(a.neg(i))).mult(n)},a.fact=function(t){return a.gamma(t.add(a.ONE))},a.cos=function(t){var r=t.mult(a.I);return a.exp(r).add(a.exp(a.neg(r))).div(a.TWO)},a.sin=function(t){var r=t.mult(a.I);return a.exp(r).sub(a.exp(a.neg(r))).div(a.TWO_I)},a.tan=function(t){var r=t.mult(a.I),n=a.exp(r),e=a.exp(a.neg(r));return n.sub(e).div(n.add(e).mult(a.I))},a.sec=function(t){var r=t.mult(a.I);return a.TWO.div(a.exp(r).add(a.exp(a.neg(r))))},a.csc=function(t){var r=t.mult(a.I);return a.TWO_I.div(a.exp(r).sub(a.exp(a.neg(r))))},a.cot=function(t){var r=t.mult(a.I),n=a.exp(r),e=a.exp(a.neg(r));return n.add(e).mult(a.I).div(n.sub(e))},a.arccos=function(t){return a.I.mult(a.log(t.add(a.NEG_I.mult(a.sqrt(a.ONE.sub(t.rPow(2)))))))},a.arcsin=function(t){return a.NEG_I.mult(a.log(t.mult(a.I).add(a.sqrt(a.ONE.sub(t.rPow(2))))))},a.arctan=function(t){var r=a.I;return r.mult(a.log(r.add(t).div(r.sub(t)))).div(a.TWO)},a.arcsec=function(t){return a.NEG_I.mult(a.log(t.rPow(-1).add(a.sqrt(a.ONE.sub(a.I.div(t.rPow(2)))))))},a.arccsc=function(t){return a.NEG_I.mult(a.log(a.I.div(t).add(a.sqrt(a.ONE.sub(t.rPow(-2))))))},a.arccot=function(t){var r=a.I;return r.mult(a.log(t.sub(r).div(t.add(r)))).div(a.TWO)},a.cosh=function(t){return a.exp(t).add(a.exp(a.neg(t))).div(a.TWO)},a.sinh=function(t){return a.exp(t).sub(a.exp(a.neg(t))).div(a.TWO)},a.tanh=function(t){var r=a.exp(t),n=a.exp(a.neg(t));return r.sub(n).div(r.add(n))},a.sech=function(t){return a.TWO.div(a.exp(t).add(a.exp(a.neg(t))))},a.csch=function(t){return a.TWO.div(a.exp(t).sub(a.exp(a.neg(t))))},a.coth=function(t){var r=a.exp(t),n=a.exp(a.neg(t));return r.add(n).div(r.sub(n))},a.arccosh=function(t){return a.log(t.add(a.sqrt(t.rPow(2).sub(a.ONE))))},a.arcsinh=function(t){return a.log(t.add(a.sqrt(t.rPow(2).add(a.ONE))))},a.arctanh=function(t){return a.log(a.ONE.add(t).div(a.ONE.sub(t))).div(a.TWO)},a.arcsech=function(t){return a.log(a.ONE.add(a.sqrt(a.ONE.sub(t.rPow(2)))).div(t))},a.arccsch=function(t){return a.log(a.ONE.add(a.sqrt(a.ONE.add(t.rPow(2)))).div(t))},a.arccoth=function(t){return a.log(t.add(a.ONE).div(t.sub(a.ONE))).div(a.TWO)},a.min=function(){var t=Array.prototype.slice.call(arguments).map(function(t){return t.m}),r=w.min.apply(w,t);return arguments[t.indexOf(r)]},a.max=function(){var t=Array.prototype.slice.call(arguments).map(function(t){return t.m}),r=w.max.apply(w,t);return arguments[t.indexOf(r)]},a.isNaN=function(t){return isNaN(t.r)||isNaN(t.i)||isNaN(t.m)||isNaN(t.t)},a.isFinite=function(t){return isFinite(t.m)},a.formatFunction=function(t){return t.replace(x,c)},d.prototype=[],d.prototype.push=function(){return Array.prototype.push.apply(this,arguments)-1},d.prototype.Complex=a,a.parseFunction=function(t,r,n){"boolean"==typeof r?(n=r,r=[]):("object"!=typeof r||null===r||r.constructor!==Array)&&(r=[]),t=t.toLowerCase(),n||(t=a.formatFunction(t));var e=s(r),i=new d,o=l(t,e,i),c=r.map(function(t){return e[t]}).join(",");return new Function(c,"var C=this.Complex;return "+o+";").bind(i)},"undefined"!=typeof module&&null!==module&&module.exports?module.exports=a:"function"==typeof define&&define.amd?define([],function(){return a}):t.Complex=a}("undefined"==typeof global?this:global)